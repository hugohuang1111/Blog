---
title: Android定时任务实探索
date: 2021-01-25
author: hugo
tag:
    - Android
    - Timer
    - AlarmManger
---

## 目标

想在 Android 上实现一个定时任务的功能, 比如每天 9:10 定时执行一个任务.

## 方案一

使用后台任务, 每一分钟执行一次, 每次执行检查一下当前的时间是否为 9:10 - 9:11 之间. 并将应用设置为可后台运行.

理论上可行, 自己调试的时候也没有什么问题, 但是来了, 如果你的设备是可能长时间静止, 没有其它操作, 那它很有可能会进入休眠, 虽然设置了可后台运行, 但是会发现, Android 为了优化电源使用, 像这种任务, 越到后面系统可能会30分钟才会触发一次. 这样就达不到想要的  9:10 左右就执行一次任务的目的了.

从运行时触发的日志来看, 如果设备长时间没人操作, 那么五六个小时(从这一次日志来看,不同系统不同时间点这个时间都可能不一样)后, 系统慢慢就不会再保证每一分钟就可以触发一次了. 系统会把所有的定时任务合到一个时间点,一次调用,调用完又会隔一段时间(时间不固定)再次调用.

## 方案二

使用 `AlarmManager.setExactAndAllowWhileIdle` (API 23+) 或 `AlarmManager.setExact` 来作精确的定时任务. 目前还在验证中.

---
转自: [HH](http://www.hugohuang.xyz/)
